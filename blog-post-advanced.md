# AI駆動開発の真髄：Gemini CLIを「思考のパートナー」にしてNext.jsアプリを爆速構築する全技術

## はじめに：AIは単なる「コード補完」ツールを超えた

2024年現在、AI開発支援ツールは戦国時代に突入しました。多くの開発者が日々のコーディングでAIの恩恵を受ける一方、その活用法は「関数を一つ作ってもらう」「エラーの解決策を尋ねる」といった、断片的なタスクに留まっているケースが少なくありません。

しかし、もしAIが単なる質問応答システムではなく、**あなたのローカル開発環境とシェルを直接操作できる「エージェント」**だとしたら？もしAIが、プロジェクトの全体像を理解し、設計思想について議論を交わし、自らファイルを作成・編集し、バージョン管理まで行うとしたら？

この記事は、Googleの「**Gemini CLI**」を、単なるツールとしてではなく、**開発プロセス全体を共に歩む「思考のパートナー」**として活用し、Next.js製のWebアプリケーションをゼロから完全に構築するまでの一部始終を記録した、実践的な技術ドキュメントです。

ここでは、コードの断片的な生成プロセスは紹介しません。代わりに、**Gemini CLIの思考プロセス、その能力を120%引き出すための対話術（プロンプトエンジニアリング）、そしてAIとの協業によって、いかにしてアイデアが具体的なプロダクトへと昇華していくのか**を、1000行を超える詳細な情報量でお届けします。

### 完成したプロダクト

このAIとのペアプログラミングで完成したのが、この「色当てクイズゲーム」です。

[![Image from Gyazo](https://i.gyazo.com/f91f7bf60fcad60c4d935db37e97a9fa.gif)](https://gyazo.com/f91f7bf60fcad60c4d935db37e97a9fa)

**GitHubリポジトリ:** [https://github.com/kazuki13070311/color-quiz-game](https://github.com/kazuki13070311/color-quiz-game)

---

## 第1章：Gemini CLIの思考モデルを理解する - AIとの対話の前に

Gemini CLIを効果的に使う鍵は、その「振る舞い」の根底にある思考モデルを理解することです。彼は人間のように直感で動くのではなく、極めて論理的なプロセスに基づいて行動します。

### Geminiの基本行動サイクル

Geminiに指示を出すと、その内部では以下のようなサイクルが高速で回っています。

1.  **【状況把握 (Observation)】**
    -   `pwd` (Print Working Directory): 「私は今どこにいるのか？」
    -   `ls -F`: 「このディレクトリには何があるのか？」
    -   Geminiは常に自身の現在地と周囲の環境を確認することから始めます。これは、全ての行動の基準点を設定するためです。

2.  **【情報収集 (Information Gathering)】**
    -   `read_file <file_path>`: 「このファイルには何が書かれているのか？」
    -   `git log -n 5`: 「最近の変更履歴はどうなっているのか？」
    -   新しい指示を受けると、Geminiはすぐに行動に移すのではなく、まず関連するファイルを読み込み、既存のコード、設定、命名規則、そしてプロジェクトの文脈を深く理解しようとします。これが、彼の提案が的外れになりにくい理由です。

3.  **【仮説と計画 (Hypothesis & Planning)】**
    -   （思考プロセス）: 「ユーザーの要求を満たすには、AファイルとBファイルを修正し、Cというコマンドを実行する必要があるだろう。手順はまずCを実行し、次にA、最後にBだ。」
    -   収集した情報に基づき、目的を達成するための具体的なステップを計画します。この計画は彼のレスポンスとして、私たちに提示されることもあります。

4.  **【行動 (Action)】**
    -   `run_shell_command <command>`: シェルコマンドを実行する。
    -   `write_file <file_path> <content>`: 新しいファイルを作成、または既存のファイルを上書きする。
    -   `replace <file_path> ...`: ファイルの一部を正確に置換する。
    -   計画に基づき、実際にファイルシステムやシェル環境に変更を加えます。

5.  **【結果確認と内省 (Verification & Reflection)】**
    -   （ツールからの返り値）: 「コマンドは成功したか？エラーメッセージは何か？」
    -   行動の結果を分析し、成功すれば次のステップへ、失敗すればその原因を分析して計画を修正します（例：「相対パスでエラーが出た。次は絶対パスで試そう」）。このフィードバックループが、彼の精度を高めていきます。

### AIに「憲法」を与える：`GEMINI.md`の絶大な効果

Geminiの思考プロセスを理解した上で、我々が彼に提供できる最も強力な武器が、プロジェクトルートに配置する`GEMINI.md`ファイルです。

これは、プロジェクト固有のルール、技術スタック、コーディング規約などを明記した、**AIのための「憲法」**です。Geminiは新しいセッションを開始する際に、このファイルを優先的に読み込み、その内容を以降の全ての行動の指針とします。

実際にこのプロジェクトで作成した`GEMINI.md`を見てみましょう。

```markdown:GEMINI.md
# Gemini 作業用ドキュメント (GEMINI.md)

このドキュメントは、AIアシスタント（Gemini）がこのプロジェクトで効率的かつ一貫性のある開発を行うためのガイドラインです。

## 1. プロジェクト概要
- **プロジェクト名:** 色当てクイズゲーム (Color Guessing Quiz)
- **目的:** 表示された色のRGB値を当てる、モダンなUI/UXを持つWebアプリケーション。
- **ターゲット:** 日本人ユーザー向けに最適化されている。

## 2. 技術スタック & アーキテクチャ
- **フレームワーク:** `Next.js` (App Router)
- **UIコンポーネント:** `shadcn/ui`
- **スタイリング:** `Tailwind CSS`
- **アニメーション:** `Framer Motion`
- **Node.jsバージョン管理:** `anyenv` (`nodenv`)
- **パッケージマネージャー:** `pnpm`

## 3. コーディング規約 & スタイルガイド
- **コンポーネント配置:** ゲームロジックに関わるコンポーネントは `app/_components/` に配置する。
- **日本語対応:** UIテキストはすべて自然な日本語で記述する。
- **コミットメッセージ:** Conventional Commits に従うこと。

## 4. 重要なコマンド
- **開発サーバー起動:** `pnpm dev`
- **UIコンポーネントの追加:** `npx shadcn@latest add <component_name>`

## 6. ドキュメントの更新
このドキュメントは、プロジェクトの進化に合わせて、Gemini自身によって定期的に見直され、常に最適な状態に更新されます。
```

このファイルがあることで、Geminiは「このプロジェクトでは`npm`ではなく`pnpm`を使うべきだな」「コミットメッセージは`feat:`から始めるべきだな」といった判断を、毎回尋ねることなく自律的に行えるようになります。これは、開発効率を劇的に向上させる、非常に重要なステップです。

---

## 第2章：設計フェーズ - AIに「何を」作るべきか考えさせる技術

優れたプロダクトは、優れた設計から生まれます。驚くべきことに、Gemini CLIはこの最も創造的で抽象的なフェーズにおいても、強力なパートナーとなり得ます。

### 曖昧なアイデアを、具体的な設計図へ

開発の第一声は、極めてシンプルでした。

> **あなた:** 「Next.jsで色当てクイズゲームを作成します。シンプルなアーキテクチャ設計にします。UIはshadcn/uiとTailwind CSSを利用して。では設計からお願いします。」

この指示に対し、Geminiはすぐさまコードを書き始めることはしませんでした。彼の最初の提案は、**「ユーザーストーリーから考えましょう」**という、開発の上流工程への介入でした。

これは、AIが単なる命令実行マシンではなく、**プロダクトの「Why（なぜ作るのか）」から思考を始める能力**を持つことを示唆しています。彼は、開発者が本当に作りたいものを定義する手助けをしようと試みたのです。

この対話を通じて、以下のようなユーザーストーリーが定義されました。

-   **プレイヤーとして、** 画面に表示された色をはっきりと見たい。**それによって、** 色を当てることに集中できるから。
-   **プレイヤーとして、** 正解するごとにスコアが上がっていくのを見たい。**それによって、** プレイを続けるモチベーションが湧くから。
-   **プレイヤーとして、** スムーズなアニメーションやトランジションを体験したい。**それによって、** ゲームがより動的で魅力的に感じられるから。

### 設計を構造化ドキュメントとして出力させる

議論が深まったところで、次の指示を出します。

> **あなた:** 「ここまでの議論を基に、要件定義書と設計書を作成してドキュメント化してください。」

この指示により、Geminiはそれまでの対話の文脈をすべて理解した上で、構造化された長文のMarkdownファイルを生成しました。これは、彼の自然言語理解能力とドキュメント生成能力の高さを示す好例です。

**生成されたドキュメントの抜粋 (`docs/details.md`):**

```markdown
## 3. コンポーネント設計

| コンポーネント名            | 役割と責務                                                                 |
| --------------------------- | -------------------------------------------------------------------------- |
| `game-container.tsx`        | ゲーム全体のロジックと状態（State）を管理する、最も中心的なコンポーネント。    |
| `score-display.tsx`         | 現在のスコアをアニメーション付きで表示する。                                 |
| `color-display.tsx`         | 当てるべき色と設問テキストをアニメーション付きで表示する。                   |

## 4. データフロー

1.  **初期化:** `game-container`が`colorUtils`を使い、`correctColor`と`options`を生成し、Stateを初期化する。
2.  **ユーザー操作:** プレイヤーが`color-option-button`をクリック。イベントが`game-container`の`handleSelectOption`に伝播する。
3.  **判定:** `handleSelectOption`内で正誤を判定し、`userChoice`と`gameState`を更新する。
...
```

**【ここから得られる教訓】**
AIとの設計フェーズでは、いきなり完璧な指示を出す必要はありません。**曖昧なアイデアを投げかけ、AIからの提案（ユーザーストーリーなど）にフィードバックを与え、議論を深めていく。**この対話的なプロセスこそが、AIを「思考のパートナー」として活用する鍵です。

---

## 第3章：実装フェーズ - 対話によるコーディングとリファクタリング

設計図が完成すれば、いよいよ建築作業の開始です。Gemini CLIのファイル操作能力とコード生成能力を駆使し、驚異的なスピードで実装を進めます。

### トップダウンな実装戦略

人間がコーディングするように、まずプロジェクトの全体像から作り始めます。

> **あなた:** 「設計書に従い、`app/_components/` ディレクトリ内に必要なコンポーネントのスケルトン（空のファイル）を一度に作成してください。」

**Geminiが実行したコマンド:**
`$ touch app/_components/game-container.tsx app/_components/score-display.tsx ...`

このように、まず構造から入ることで、AIもプロジェクトの全体像を把握しやすくなります。

### 反復的な実装サイクル

次に、コンポーネントを一つずつ、しかし反復的に肉付けしていきます。

1.  **静的UIの実装:**
    > **あなた:** 「まず、各コンポーネントを静的なUIとして実装してください。Propsにはダミーデータを使い、見た目だけを先に作ります。」

2.  **ロジックの注入:**
    > **あなた:** 「次に、`GameContainer.tsx`に、`useState`と`useEffect`を使った状態管理ロジックを実装してください。`colorUtils.ts`から関数をインポートして、動的に問題が生成されるようにします。」

3.  **コンポーネントの連携:**
    > **あなた:** 「最後に、`GameContainer`から各子コンポーネントへ、Propsとして状態とハンドラ関数を渡してください。ボタンをクリックしたら、`handleSelectOption`が呼ばれるようにします。」

この**「UI → ロジック → 連携」**という反復的なサイクルは、人間にとってもAIにとっても理解しやすく、着実に開発を進めるための効果的な戦略です。

### AIによるリファクタリングと機能追加

基本的なゲームが完成した後、より高度な要求を投げかけます。

> **あなた:** 「このアプリを日本人向けのモダンなデザインに仕上げましょう。日本語フォントを導入し、UIを日本語化し、`framer-motion`でリッチなアニメーションを追加してください。」

この抽象的な要求に対し、Geminiは具体的な行動計画を立てて実行しました。

1.  **パッケージ追加:** `pnpm add framer-motion` を実行。
2.  **レイアウト修正:** `app/layout.tsx` を読み込み、`next/font` を使って`Noto_Sans_JP`をインポート。さらに、`<body>`タグにグラデーション背景のTailwindクラスを追加。
3.  **コンポーネント修正:** `ColorDisplay.tsx` や `GameOverDialog.tsx` などの各コンポーネントファイルを開き、`motion`コンポーネントと`AnimatePresence`タグを追加。`initial`, `animate`, `exit`といったプロパティを記述し、具体的なアニメーションを実装。
4.  **テキスト修正:** UI上のすべての英語テキストを、自然な日本語に置換。

この一連の作業は、AIが**複数のファイルにまたがる横断的な変更**を、文脈を保ちながら実行できる高度な能力を持っていることを示しています。これは、単一のファイルを修正するレベルを遥かに超えた、真のリファクタリング能力です。

---

## 第4章：開発を加速させるGemini CLIとの対話術

Gemini CLIの能力を最大限に引き出すには、単に命令するだけでなく、質の高い対話を行うためのいくつかのテクニックが必要です。

### 1. 役割を与える（ロールプレイング）

AIに特定の役割を演じさせることで、出力の質と方向性をコントロールできます。

-   **悪い例:** 「UIを良くして。」
-   **良い例:** 「**あなたは経験豊富なUI/UXデザイナーです。** このゲームのユーザーエンゲージメントを高めるための改善案を3つ、具体的な実装方針と共に提案してください。」

### 2. 思考プロセスを尋ねる

AIの提案の意図を理解し、より良い解決策を探るために有効です。

-   **例:** 「なぜそのアニメーション（`ease-out`）を選んだのですか？ `ease-in-out` との違いは何ですか？この文脈ではどちらがより適切だと思いますか？」

### 3. 具体的なコンテキストを提供する

エラー報告や質問の際は、AIが状況を正確に再現できるだけの情報を提供します。

-   **悪い例:** 「動かない。直して。」
-   **良い例:** 「`pnpm dev`を実行したところ、このエラーメッセージが出力されました。`[エラーメッセージを貼り付け]`。ちなみに、`node -v`の結果は`20.11.1`で、`.node-version`ファイルも存在します。原因として何が考えられますか？」

### 4. 自己修正を促すフィードバックループ

AIが失敗したときこそ、学習のチャンスです。失敗を責めるのではなく、結果を伝えて再考を促します。

-   **例:** 「その`replace`コマンドは失敗しました。`old_string`が見つからなかったようです。これが現在の`app/layout.tsx`の全内容です。`[read_fileの結果を貼り付け]`。これを基に、もう一度正確な`replace`コマンドを生成してください。」

### 5. バージョン管理までを自動化する

コーディングの区切りが良いところで、バージョン管理までを指示に含めます。

-   **例:** 「ここまでのUI改善をコミットしてください。コミットメッセージは`feat: Enhance UI with animations and Japanese localization`でお願いします。その後、GitHubの`origin/main`にプッシュしてください。」

この対話術を駆使することで、Gemini CLIは単なるコード生成器から、プロジェクトの文脈を深く理解し、自律的にタスクを遂行する**真の「開発エージェント」**へと進化します。

---

## 結論：AIと共に創る、新しい開発の地平

この挑戦を通じて明らかになったのは、Gemini CLIがもたらす開発体験が、もはや従来のものとは全く異なる次元にあるという事実です。

我々開発者の役割は、一行一行コードを書く「作業者」から、**AIという強力な思考パートナーに対し、的確な問いを立て、その能力を最大限に引き出し、プロジェクト全体の方向性を定める「設計者」であり「指揮者」**へとシフトしていきます。

重要なのは、AIの思考プロセスを理解し、敬意を払い、そして質の高い対話を通じて信頼関係を築くことです。AIに「憲法」を与え、役割を定義し、時にはその思考を問い、失敗から共に学ぶ。この人間とAIの新しい関係性こそが、これからのソフトウェア開発の生産性と創造性を、根底から変えていくことになるでしょう。

この記事が、あなたのAI駆動開発への第一歩となれば幸いです。さあ、未来の開発スタイルを今すぐ始めましょう。
